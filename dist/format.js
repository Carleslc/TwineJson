window.storyFormat({
	"name":"TwineJson",
	"version":"0.0.3",
	"author":"<a href='http://www.papricacomunicacao.com.br'>Páprica Comunicação</a>",
	"description":"Free utility format to export your story into json format. Based on Entweedle by Michael McCollum",
	"image":"icon.svg",
	"url":"http://www.papricacomunicacao.com.br",
	"license":"<a href='http://opensource.org/licenses/MIT'>MIT License</a>",
	"proofing":false,
	"source":"<html><head><title>{{STORY_NAME}}</title></head><body><script type=text/javascript>window.onload=function(){\"undefined\"==typeof window.TwineJson&&(window.TwineJson={convert:function(){for(var e=window.document.getElementById(\"output\"),n=this[\"export\"](),t=JSON.parse(n),s=t,r=[],i=0;i<s.length;i++)if(s[i].children=[],\"\"!=s[i].childrenNames){for(var u=s[i].childrenNames.split(\",\"),a=0;a<u.length;a++)for(var h=0;h<s.length;h++)u[a]==\"[[\"+s[h].name+\"]]\"&&s[i].children.push(s[h]);r.push(s[i])}console.dir(r[0]),e.innerHTML=JSON.stringify(r[0])},\"export\":function(){var e=[];e.push(\"[\\r\\n\");var n=window.document.getElementsByTagName(\"tw-storydata\");n&&e.push(this.buildPassage(\"StoryTitle\",\"\",n[0].getAttribute(\"name\")));var t=window.document.getElementById(\"twine-user-script\");t&&e.push(this.buildPassage(\"UserScript\",\"script\",t.innerHTML));var s=window.document.getElementById(\"twine-user-stylesheet\");s&&e.push(this.buildPassage(\"UserStylesheet\",\"stylesheet\",s.innerHTML));for(var r=window.document.getElementsByTagName(\"tw-passagedata\"),i=0;i<r.length;++i)e.push(this.buildPassageFromElement(r[i],i,r.length));return e.push(\"]\\r\\n\"),e.join(\"\")},buildPassageFromElement:function(e,n,t){var s=!1;n+1==t&&(s=!0);var r=e.getAttribute(\"name\");r||(r=\"Untitled Passage\");var i=e.getAttribute(\"tags\"),u=e.textContent;return this.buildPassage(r,i,u,s)},buildPassage:function(e,n,t,s){var r=[];return r.push(\"{\\r\\n\"),r.push('\t\"name\" : '),r.push('\"',e,'\"'),n&&(r.push(\",\\r\\n\"),r.push('\t\"tags\" : '),r.push('\"[',n,']\"')),r.push(\",\\r\\n\"),r.push('\t\"content\" : '),r.push('\"',this.scrub(t),'\",\\r\\n'),r.push('\t\"childrenNames\" : '),r.push('\"',this.findChildren(t),'\"\\r\\n'),r.push('\t\"features\" : '),r.push('\"',this.findFeatures(t),'\"\\r\\n'),r.push(s?\"}\\r\\n\":\"},\\r\\n\"),r.join(\"\")},scrub:function(e){return e&&(e=e.replace(/^\\\"/gm,\"'\"),e=e.replace(/(\\r\\n|\\n|\\r)/gm,\"  \")),e},findChildren:function(e){for(var n,t=/\\[\\[(.+?)\\]\\]/gm,s=[];null!=(n=t.exec(e));)s.push(n[0]);return s},findFeatures:function(e){var n,t=/\\{\\{features\\}\\}(.+?)\\{\\{\\/features\\}\\}/gm,s=[];return n=t.exec(e),null!=n&&s.push(n[1]),s}}),window.TwineJson.convert()};</script><pre id=output></pre><div id=storyData style=\"display: none;\">{{STORY_DATA}}</div></body></html>"
});