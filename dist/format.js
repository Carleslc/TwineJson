window.storyFormat({
	"name":"TwineJson",
	"version":"0.0.4",
	"author":"<a href='http://www.papricacomunicacao.com.br'>Páprica Comunicação</a>",
	"description":"Free utility format to export your story into JSON format. Based on Entweedle by Michael McCollum",
	"image":"icon.svg",
	"url":"http://www.papricacomunicacao.com.br",
	"license":"<a href='http://opensource.org/licenses/MIT'>MIT License</a>",
	"proofing":false,
	"source":"<html><head><title>{{STORY_NAME}}</title></head><body><script type=text/javascript>window.onload=function(){if(\"undefined\"==typeof window.TwineJson){var e=0,r={isHierarchical:!0,exportOrder:!0,exportFeatures:!0,exportID:!0};window.TwineJson={isCyclic:function(e){function r(e){if(e&&\"object\"==typeof e){if(-1!==n.indexOf(e))return!0;n.push(e);for(var t in e)if(e.hasOwnProperty(t)&&r(e[t]))return console.error(e,\"Found cycle at \"+t),!0}return!1}var n=[];return r(e)},convert:function(){var e=window.document.getElementById(\"output\"),n=this[\"export\"](),t=JSON.parse(n),s=t;if(r.isHierarchical){for(var i=[],u=0;u<s.length;u++)if(s[u].children=[],\"\"!==s[u].childrenNames){for(var a=s[u].childrenNames.split(\",\"),o=0;o<a.length;o++)for(var h=0;h<s.length;h++)a[o]==\"[[\"+s[h].name+\"]]\"&&s[u].children.push(s[h]);i.push(s[u])}this.isCyclic(i[0])?e.innerHTML=\"<h2>Error: Cyclic reference found</h2><br>Cyclic references aren't allowed in hierarchical JSON structures.<br>Please set ExportOptions.isHierarchical to false to use cyclic references.\":(console.dir(i[0]),e.innerHTML=JSON.stringify(i[0]))}else e.innerHTML=JSON.stringify(s)},\"export\":function(){var e=[];e.push(\"[\\r\\n\");var r=window.document.getElementsByTagName(\"tw-storydata\");r&&e.push(this.buildPassage(\"StoryTitle\",\"\",r[0].getAttribute(\"name\")));var n=window.document.getElementById(\"twine-user-script\");n&&e.push(this.buildPassage(\"UserScript\",\"script\",n.innerHTML));var t=window.document.getElementById(\"twine-user-stylesheet\");t&&e.push(this.buildPassage(\"UserStylesheet\",\"stylesheet\",t.innerHTML));for(var s=window.document.getElementsByTagName(\"tw-passagedata\"),i=0;i<s.length;++i)e.push(this.buildPassageFromElement(s[i],i,s.length));return e.push(\"]\\r\\n\"),e.join(\"\")},buildPassageFromElement:function(e,r,n){var t=!1;r+1==n&&(t=!0);var s=e.getAttribute(\"name\");s||(s=\"Untitled Passage\");var i=e.getAttribute(\"tags\"),u=e.textContent;return this.buildPassage(s,i,u,t)},buildPassage:function(n,t,s,i){var u=[];u.push(\"{\\r\\n\"),r.exportID&&(u.push('\t\"id\" : '),u.push('\"',e++,'\"')),u.push(\",\\r\\n\"),u.push('\t\"name\" : '),u.push('\"',n,'\"'),t&&(u.push(\",\\r\\n\"),u.push('\t\"tags\" : '),u.push('\"[',t,']\"'));var a=this.scrub(s,\" \");return u.push(\",\\r\\n\"),u.push('\t\"content\" : '),u.push('\"',a,'\"'),u.push(\",\\r\\n\"),u.push('\t\"childrenNames\" : '),u.push('\"',this.findChildren(a),'\"'),r.exportFeatures&&(u.push(\",\\r\\n\"),u.push('\t\"features\" :'),u.push(\"\",this.findFeatures(s),\"\\r\\n\")),r.exportOrder&&(u.push(\",\\r\\n\"),u.push('\t\"order\" :'),u.push(\"\",this.findOrder(s),\"\\r\\n\")),u.push(i?\"}\\r\\n\":\"},\\r\\n\"),u.join(\"\")},scrub:function(e,r){return e&&(e=e.replace(/\\\"/gm,\"'\"),e=e.replace(/(\\r\\n|\\n|\\r)/gm,r)),e},findChildren:function(e){for(var r,n=/\\[\\[(.+?)\\]\\]/gm,t=[];null!==(r=n.exec(e));)t.push(r[0]);return t},findOrder:function(e){for(var r,n=/\\{\\{order\\}\\}((\\s|\\S)+?)\\{\\{\\/order\\}\\}/gm,t=[];null!==(r=n.exec(e));){for(var s=r[1].split(/(\\r\\n|\\n|\\r)/gm),i=0;i<s.length;i++)s[i].length<=1&&(s.splice(i,1),i=-1);for(var u=0;u<s.length;u++)featureJSON.order=s[u],t.push(featureJSON)}return JSON.stringify(t)},findFeatures:function(e){for(var r,n=/\\{\\{features\\}\\}((\\s|\\S)+?)\\{\\{\\/features\\}\\}/gm,t=[];null!==(r=n.exec(e));){for(var s=r[1].split(/(\\r\\n|\\n|\\r)/gm),i=0;i<s.length;i++)s[i].length<=1&&(s.splice(i,1),i=-1);for(var u=0;u<s.length;u++){var a=/\\(([^)]+)\\)/,o=a.exec(s[u]),h={};null!==o&&o[1]&&(s[u]=s[u].replace(/\\(([^)]+)\\)/gi,\"\"),h.subtitle=o[1]),\":\"==s[u][0]&&(h.separator=!0,s[u]=s[u].substring(1)),\"*\"==s[u][0]&&(h.star=!0,s[u]=s[u].substring(1)),\"+\"==s[u][0]&&(h.delta=!0,s[u]=s[u].substring(1)),\"-\"==s[u][0]&&(h.optional=!0,s[u]=s[u].substring(1)),h.name=s[u],t.push(h)}}return JSON.stringify(t)}}}window.TwineJson.convert()};</script><pre id=output></pre><div id=storyData style=\"display: none;\">{{STORY_DATA}}</div></body></html>"
});