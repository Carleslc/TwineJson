window.storyFormat({
	"name":"TwineJson",
	"version":"0.0.3",
	"author":"<a href='http://www.papricacomunicacao.com.br'>Páprica Comunicação</a>",
	"description":"Free utility format to export your story into json format. Based on Entweedle by Michael McCollum",
	"image":"icon.svg",
	"url":"http://www.papricacomunicacao.com.br",
	"license":"<a href='http://opensource.org/licenses/MIT'>MIT License</a>",
	"proofing":false,
	"source":"<html><head><title>{{STORY_NAME}}</title></head><body><script type=text/javascript>window.onload=function(){if(\"undefined\"==typeof window.TwineJson){var e={isHierarchical:!0,exportFeatures:!1};window.TwineJson={convert:function(){var n=window.document.getElementById(\"output\"),t=this[\"export\"](),r=JSON.parse(t),s=r;if(e.hierarchical){for(var i=[],a=0;a<s.length;a++)if(s[a].children=[],\"\"!=s[a].childrenNames){for(var u=s[a].childrenNames.split(\",\"),h=0;h<u.length;h++)for(var o=0;o<s.length;o++)u[h]==\"[[\"+s[o].name+\"]]\"&&s[a].children.push(s[o]);i.push(s[a])}console.dir(i[0]),n.innerHTML=JSON.stringify(i[0])}else n.innerHTML=JSON.stringify(s)},\"export\":function(){var e=[];e.push(\"[\\r\\n\");var n=window.document.getElementsByTagName(\"tw-storydata\");n&&e.push(this.buildPassage(\"StoryTitle\",\"\",n[0].getAttribute(\"name\")));var t=window.document.getElementById(\"twine-user-script\");t&&e.push(this.buildPassage(\"UserScript\",\"script\",t.innerHTML));var r=window.document.getElementById(\"twine-user-stylesheet\");r&&e.push(this.buildPassage(\"UserStylesheet\",\"stylesheet\",r.innerHTML));for(var s=window.document.getElementsByTagName(\"tw-passagedata\"),i=0;i<s.length;++i)e.push(this.buildPassageFromElement(s[i],i,s.length));return e.push(\"]\\r\\n\"),e.join(\"\")},buildPassageFromElement:function(e,n,t){var r=!1;n+1==t&&(r=!0);var s=e.getAttribute(\"name\");s||(s=\"Untitled Passage\");var i=e.getAttribute(\"tags\"),a=e.textContent;return this.buildPassage(s,i,a,r)},buildPassage:function(n,t,r,s){var i=[];i.push(\"{\\r\\n\"),i.push('\t\"name\" : '),i.push('\"',n,'\"'),t&&(i.push(\",\\r\\n\"),i.push('\t\"tags\" : '),i.push('\"[',t,']\"'));var a=this.scrub(r,\" \");return i.push(\",\\r\\n\"),i.push('\t\"content\" : '),i.push('\"',a,'\"'),i.push(\",\\r\\n\"),i.push('\t\"childrenNames\" : '),i.push('\"',this.findChildren(a),'\"'),e.exportFeatures&&(i.push(\",\\r\\n\"),i.push('\t\"features\" :'),i.push(\"\",this.findFeatures(r),\"\\r\\n\")),i.push(s?\"}\\r\\n\":\"},\\r\\n\"),i.join(\"\")},scrub:function(e,n){return e&&(e=e.replace(/\\\"/gm,\"'\"),e=e.replace(/(\\r\\n|\\n|\\r)/gm,n)),e},findChildren:function(e){for(var n,t=/\\[\\[(.+?)\\]\\]/gm,r=[];null!=(n=t.exec(e));)r.push(n[0]);return r},findFeatures:function(e){for(var n,t=/\\{\\{features\\}\\}((\\s|\\S)+?)\\{\\{\\/features\\}\\}/gm,r=[];null!=(n=t.exec(e));){for(var s=n[1].split(/(\\r\\n|\\n|\\r|\\,)/gm),i=0;i<s.length;i++)s[i].length<=1&&(s.splice(i,1),i=-1);for(var i=0;i<s.length;i++){var a={};\"*\"==s[i][0]&&(a.star=!0,s[i]=s[i].substring(1)),\"+\"==s[i][0]&&(a.delta=!0,s[i]=s[i].substring(1)),\"-\"==s[i][0]&&(a.optional=!0,s[i]=s[i].substring(1)),a.name=s[i],r.push(a)}}return JSON.stringify(r)}}}window.TwineJson.convert()};</script><pre id=output></pre><div id=storyData style=\"display: none;\">{{STORY_DATA}}</div></body></html>"
});